/* === Унификация размеров контролов === */
.form-control.form-control-sm,
.form-select.form-select-sm,
.nselect-toggle,
.btn.btn-sm{
  height: var(--ctl-h);
  padding-top: 0.38rem !important;
  padding-bottom: 0.38rem !important;
  line-height: calc(var(--ctl-h) - 2px - 0.76rem);
  border-radius:10px;
}
.btn.btn-sm{ display:inline-flex; align-items:center; }

/* Базовые поля */
.form-control, .form-select {
  color:var(--on-surface)!important;
  background-color:var(--field-bg) !important;
  border-radius:10px; border:1px solid var(--border) !important;
  transition:background-color .15s ease, border-color .15s ease, box-shadow .15s ease;
  -webkit-appearance:none; -moz-appearance:none; appearance:none;
}
.form-control:focus, .form-select:focus, .form-control:active, .form-select:active{
  background-color:var(--field-bg-focus) !important;
  color:var(--on-surface)!important; border-color:var(--primary)!important; box-shadow:var(--focus)!important; outline:none;
}
.form-control::placeholder { color:var(--on-surface-variant); opacity:1; }
.form-select option { color:var(--on-surface); background:var(--surface); }
.field-outlined{ border:1px solid var(--border); }

/* ===== Кастомные SELECT (NiceSelect) ===== */
.nselect{ position:relative; display:block; }
.nselect.is-open .nselect-toggle{ border-color:var(--primary) !important; box-shadow:var(--focus)!important; }
.nselect select{ position:absolute; inset:0; width:100%; height:100%; opacity:0; pointer-events:none; }

.nselect-toggle{
  display:flex; align-items:center; justify-content:space-between; gap:.6rem;
  width:100%; padding:.38rem .9rem; border-radius:10px;
  background:var(--field-bg); border:1px solid var(--border);
  color:var(--on-surface); cursor:pointer; user-select:none;
  transition:background .15s ease, border-color .15s ease, box-shadow .15s ease;
}
.nselect-toggle:hover{ background:var(--field-bg-focus); }
.nselect-toggle:focus-visible{ outline:none; border-color:var(--primary); box-shadow:var(--focus); }

.nselect-label{ overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.nselect-caret{
  width:18px; height:18px; flex:0 0 18px;
  background: center/contain no-repeat url("data:image/svg+xml,%3Csvg width='18' height='18' viewBox='0 0 16 16' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23BBBBBB' d='M4.47 6.97a.75.75 0 011.06 0L8 9.44l2.47-2.47a.75.75 0 111.06 1.06L8.53 11.06a.75.75 0 01-1.06 0L4.47 8.03a.75.75 0 010-1.06z'/%3E%3C/svg%3E");
  opacity:.9; transition: transform .15s ease, opacity .15s ease;
}
.nselect.is-open .nselect-caret{ transform:rotate(180deg); opacity:1; }

.nselect-menu{
  position:absolute; left:0; right:0; top:calc(100% + 6px);
  background:var(--surface); color:var(--on-surface);
  border:1px solid var(--border); border-radius:12px;
  box-shadow: var(--elev-2);
  padding:6px; z-index:1000; max-height:320px; overflow:auto;
  transform-origin: top; transform: scale(.98); opacity:0; pointer-events:none;
  transition: transform .12s ease, opacity .12s ease;
}
.nselect.is-open .nselect-menu{ transform: scale(1); opacity:1; pointer-events:auto; }

.nselect-option{
  padding:.45rem .6rem; border-radius:8px; cursor:pointer; user-select:none;
  display:flex; align-items:center; justify-content:space-between; gap:.6rem;
}
.nselect-option:hover{ background:rgba(255,255,255,0.06); }
.nselect-option.is-selected{ background:var(--ink-active-bg); color:var(--on-surface); }
[data-theme="light"] .nselect-option:hover{ background:rgba(0,0,0,0.06); }

/* ===== Числовые поля: свои степперы ===== */
input[type=number]::-webkit-outer-spin-button,
input[type=number]::-webkit-inner-spin-button{ -webkit-appearance: none; margin: 0; }
input[type=number]{ -moz-appearance:textfield; }

.num-input{ position:relative; display:block; }
.num-input .form-control{ padding-right:2.2rem !important; height: var(--ctl-h); }
.num-step{
  position:absolute; top:2px; bottom:2px; right:2px; width:26px;
  display:flex; flex-direction:column; gap:2px;
}
.num-step button{
  flex:1; border:1px solid var(--border); background:var(--field-bg);
  color:var(--on-surface-variant); border-radius:8px; font-size:12px; line-height:1;
  display:flex; align-items:center; justify-content:center; cursor:pointer;
  transition: background .15s ease, border-color .15s ease, color .15s ease, transform .05s ease;
}
.num-step button:hover{ background:var(--field-bg-focus); color:var(--on-surface); }
.num-step button:active{ transform: translateY(1px); }
.num-step .up::before,
.num-step .down::before{ content:""; width:12px; height:12px; background:center/contain no-repeat; display:block; opacity:.9; }
.num-step .up::before{ background-image:url("data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 16 16' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23BBBBBB' d='M8 4l4 5H4l4-5z'/%3E%3C/svg%3E"); }
.num-step .down::before{ background-image:url("data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 16 16' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23BBBBBB' d='M8 12l-4-5h8l-4 5z'/%3E%3C/svg%3E"); }

/* Чипы */
.chips{ display:flex; gap:.5rem; overflow-x:auto; overflow-y:hidden; white-space:nowrap; scrollbar-width:none; }
.chips::-webkit-scrollbar{ display:none; }
.chip{
  flex:0 0 auto; display:inline-flex; align-items:center; gap:.35rem; padding:.42rem .8rem;
  border:1px solid var(--border); border-radius:999px; background:rgba(255,255,255,0.02); color:var(--on-surface);
  cursor:pointer; user-select:none; position:relative; overflow:hidden; line-height:1.05;
  transition:background .15s ease, border-color .15s ease, transform .12s ease, box-shadow .18s ease;
}
.chip .bi{ font-size:1rem; }
.chip:hover{ transform: translateY(-1px); }
.chip.selected{
  background:var(--grad-2); border-color:transparent; color:#fff;
  box-shadow: 0 0 0 1px rgba(255,255,255,0.06) inset, 0 6px 14px rgba(0,0,0,0.22);
  background-size:200% 200%; animation:gradientShift 10s ease infinite;
}
.chip.selected::before{
  content:""; position:absolute; inset:-20% -30%;
  background: radial-gradient(60% 60% at 30% 30%, rgba(255,255,255,0.20), rgba(255,255,255,0));
  filter: blur(6px); pointer-events:none;
}
.chip::after{ content:""; position:absolute; inset:auto; width:0; height:0; border-radius:50%; background:rgba(255,255,255,0.18); transform:translate(-50%,-50%); transition:width .35s,height .35s; }
.chip:active::after{ left:var(--x); top:var(--y); width:220%; height:220%; }

/* Toolbar */
.toolbar{ display:flex; flex-wrap:wrap; gap:.75rem 1rem; align-items:end; }
.toolbar .group{ display:flex; flex-direction:column; gap:.25rem; min-width:140px; }
.toolbar .group.narrow{ min-width:110px; }
