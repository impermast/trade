:root{
  /* Палитра v2 */
  --primary:#6E46FF;
  --primary-variant:#5634CA;
  --secondary:#20C9C3;
  --secondary-variant:#1AAFAA;

  --bg:#101115;
  --surface:#171A1F;
  --on-surface:rgba(255,255,255,0.92);
  --on-surface-variant:rgba(255,255,255,0.70);
  --muted:var(--on-surface-variant);
  --border:#242834;
  --error:#F0685F;
  --grid:rgba(255,255,255,.05);

  --field-bg:#14171d;
  --field-bg-focus:#1d2129;

  --elev-1:0 2px 6px rgba(0,0,0,.28);
  --elev-2:0 8px 18px rgba(0,0,0,.28);

  --radius:14px;
  --focus:0 0 0 .2rem rgba(110,70,255,.20);

  /* Динамические градиенты */
  --grad-1: linear-gradient(90deg, var(--primary), var(--secondary));
  --grad-2: linear-gradient(135deg, var(--primary-variant), var(--secondary-variant));
}

@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50%{ background-position: 100% 50%; }
  100%{ background-position: 0% 50%; }
}

[data-theme="light"]{
  --primary:#5E58FF;
  --primary-variant:#4B43D1;
  --secondary:#1EC1BB;
  --secondary-variant:#16A6A1;

  --bg:#F6F7FB;
  --surface:#FFFFFF;
  --on-surface:rgba(0,0,0,0.90);
  --on-surface-variant:rgba(0,0,0,0.66);
  --muted:var(--on-surface-variant);
  --border:#E5E7EF;
  --error:#E65C53;
  --grid:rgba(0,0,0,.06);

  --field-bg:#ffffff;
  --field-bg-focus:#f3f4f8;

  --elev-1:0 1px 2px rgba(0,0,0,.08), 0 1px 3px rgba(0,0,0,.04);
  --elev-2:0 6px 16px rgba(0,0,0,.10), 0 2px 22px rgba(0,0,0,.06);

  /* FIX: принудительно делаем тёмные тексты в светлой теме там, где .navbar-dark красила светлым */
}
/* Light theme: fix navbar text colors forced by .navbar-dark */
[data-theme="light"] .navbar.navbar-dark .navbar-brand,
[data-theme="light"] .navbar.navbar-dark .nav-link,
[data-theme="light"] .navbar.navbar-dark .form-check-label,
[data-theme="light"] .navbar.navbar-dark .navbar-text {
  color: var(--on-surface) !important;
}
[data-theme="light"] .navbar.navbar-dark .form-check-input {
  border-color: var(--border) !important;
  background-color: transparent !important;
}
[data-theme="light"] .navbar.navbar-dark .btn.btn-outline-light {
  color: var(--on-surface) !important;
  border-color: var(--border) !important;
  background: transparent !important;
}
[data-theme="light"] .navbar.navbar-dark .btn.btn-outline-light.active,
[data-theme="light"] .navbar.navbar-dark .btn.btn-outline-light.show {
  color: #fff !important;
}
/* Light theme: fix all .btn-outline-light text/border colors for readability */
[data-theme="light"] .btn-outline-light {
  color: var(--on-surface) !important;
  border-color: var(--border) !important;
}
[data-theme="light"] .btn-outline-light:hover {
  background-color: rgba(0,0,0,0.04) !important;
}
[data-theme="light"] .btn-outline-light.active,
[data-theme="light"] .btn-outline-light.show {
  color: #fff !important;
  border-color: transparent !important;
}

html, body { height:100%; background:var(--bg); color:var(--on-surface); overflow-x:hidden; }
body { font-family:"Roboto Flex", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif; }

.navbar{ background:var(--surface)!important; border-bottom:1px solid var(--border); box-shadow:var(--elev-1); }
.content{ padding:18px; }

/* Единая глубина */
.card{
  background:var(--surface); border:1px solid var(--border); border-radius:var(--radius);
  box-shadow:var(--elev-1); color:var(--on-surface); transition:transform .18s ease, box-shadow .18s ease;
}
.card.kpi{ box-shadow:var(--elev-2); }
.card:hover{ transform:translateY(-1px); box-shadow:var(--elev-2); }

/* Типографика */
.kpi-sub{ font:600 0.95rem/1.25 "Roboto Flex", sans-serif; letter-spacing:.015em; color:var(--on-surface-variant)!important; }
.kpi-value{ font:700 1.6rem/1.15 "Roboto Flex", sans-serif; color:var(--on-surface)!important; }
.form-label, .text-muted { color:var(--on-surface-variant)!important; }

/* Контролы */
.form-control, .form-select {
  color:var(--on-surface)!important;
  background-color:var(--field-bg) !important;
  border-radius:10px;
  transition:background-color .15s ease, border-color .15s ease, box-shadow .15s ease;
}
.form-control:focus, .form-select:focus, .form-control:active, .form-select:active {
  background-color:var(--field-bg-focus) !important;
  color:var(--on-surface)!important;
  border-color:var(--primary)!important;
  box-shadow:var(--focus)!important;
  outline:none;
}
.form-control::placeholder { color:var(--on-surface-variant); opacity:1; }
.form-select option { color:var(--on-surface); background:var(--surface); }
.field-outlined{ border:1px solid var(--border); }

/* Tabs + ink (spring) */
.nav-tabs{ border-color:transparent; position:relative; }
.nav-tabs .nav-link{
  border:none; display:flex; align-items:center; gap:.5rem;
  color:var(--on-surface-variant)!important; position:relative;
  background:transparent;
}
.nav-tabs .nav-link.active { background-color: rgba(255,255,255,0.06) !important; color: var(--on-surface) !important; font-weight: 600; }
.tabs-ink{
  position:absolute; height:2px; bottom:-2px; background:var(--grad-1);
  border-radius:2px; pointer-events:none; width:0; transform:translateX(0);
  transition: width .28s cubic-bezier(.2,.8,.2,1.6), transform .28s cubic-bezier(.2,.8,.2,1.6);
  background-size: 200% 200%; animation: gradientShift 7s ease infinite;
}

/* Сегменты хвоста */
#tailSegments.btn-group .btn{ border-radius:0!important; padding:.35rem .8rem; line-height:1; }
#tailSegments.btn-group .btn + .btn{ margin-left:-1px; }
#tailSegments.btn-group .btn:first-child{ border-top-left-radius:999px!important; border-bottom-left-radius:999px!important; }
#tailSegments.btn-group .btn:last-child{ border-top-right-radius:999px!important; border-bottom-right-radius:999px!important; }
#tailSegments .btn-outline-light.active{
  color:#fff!important; border-color:transparent!important;
  background:var(--grad-2)!important; background-size:200% 200%; animation:gradientShift 8s ease infinite;
  box-shadow:0 4px 12px rgba(0,0,0,.22);
}

/* Общий градиент для active outline-кнопок */
.btn-outline-light.active,
.btn-outline-light.show{
  background:var(--grad-2)!important; color:#fff!important; border-color:transparent!important;
  background-size:200% 200%; animation:gradientShift 8s ease infinite;
}
.btn-outline-light:hover{ background:rgba(255,255,255,.06); }

/* Чипы — в одну строку, без переноса */
.chips{
  display:flex; gap:.5rem; overflow-x:auto; overflow-y:hidden; white-space:nowrap; scrollbar-width:none;
}
.chips::-webkit-scrollbar{ display:none; }
.chip{
  flex:0 0 auto;
  display:inline-flex; align-items:center; gap:.35rem; padding:.42rem .8rem;
  border:1px solid var(--border); border-radius:999px;
  background:rgba(255,255,255,0.02); color:var(--on-surface);
  cursor:pointer; user-select:none; position:relative; overflow:hidden; line-height:1.05;
  transition:background .15s ease, border-color .15s ease, transform .12s ease;
}
.chip .bi{ font-size:1rem; }
.chip:hover{ transform: translateY(-1px); }
.chip.selected{
  background:var(--grad-2);
  border-color:transparent;
  color:#fff;
  box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset, 0 6px 14px rgba(0,0,0,.22);
  background-size:200% 200%; animation:gradientShift 10s ease infinite;
}
.chip::after{ content:""; position:absolute; inset:auto; width:0; height:0; border-radius:50%; background:rgba(255,255,255,.18); transform:translate(-50%,-50%); transition:width .35s,height .35s; }
.chip:active::after{ left:var(--x); top:var(--y); width:220%; height:220%; }

.toolbar{ display:flex; flex-wrap:wrap; gap:.75rem 1rem; align-items:end; }
.toolbar .group{ display:flex; flex-direction:column; gap:.25rem; min-width:140px; }
.toolbar .group.narrow{ min-width:110px; }

/* Таблица: зебра + табличные цифры */
.table-md3{ width:100%; border-collapse:separate; border-spacing:0; }
.table-md3 thead th{ position:sticky; top:0; background:var(--surface); z-index:1; border-bottom:1px solid var(--border); padding:.5rem .6rem; font-weight:700; }
.table-md3 tbody td{ border-bottom:1px solid var(--border); padding:.48rem .6rem; }
.table-md3 tbody tr:nth-child(even){ background:rgba(255,255,255,.02); }
.table-md3 .num{ text-align:right; font-variant-numeric: tabular-nums; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

#chart{ height:560px; position:relative; }
.loading-overlay{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,.14); border-radius:10px; z-index:5; }
.log-box{ height:420px; overflow-y:auto; white-space:pre-wrap; background:#0b0e14; color:#dcdcdc; padding:10px; border:1px solid var(--border); border-radius:10px; }

/* Скелетоны — вариативная ширина */
.skeleton{display:inline-block;width:100%;height:1.2rem;border-radius:8px;background:
  linear-gradient(90deg,rgba(255,255,255,.06),rgba(255,255,255,.12),rgba(255,255,255,.06));
  background-size:200% 100%;animation:shimmer 1.2s infinite}
.skeleton.sm{height:.9rem}
.skeleton.lg{height:1.8rem}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

/* Прогресс-лайн */
#topProgress{
  position:fixed; left:0; right:0; top:0; height:3px;
  background:var(--grad-1);
  width:0; transition:width .25s; display:none; z-index:1200; pointer-events:none;
  background-size:200% 200%; animation:gradientShift 10s ease infinite;
}

.chart-actions{ position:relative; }

/* FAB с мягким пульсом */
.fab{
  position:absolute; right:14px; bottom:14px;
  display:inline-flex; align-items:center; gap:.55rem;
  padding:.6rem 1rem .6rem .85rem;
  background:var(--grad-1); color:#fff; border:none;
  border-radius:999px; box-shadow:var(--elev-2); z-index:6;
  line-height:1; font-weight:700;
  background-size:200% 200%; animation:gradientShift 9s ease infinite;
}
.fab:hover{ filter:brightness(.97); }
.fab::after{ content:""; position:absolute; inset:-3px; border-radius:999px; border:2px solid rgba(255,255,255,.14); pointer-events:none; }
.fab.pulse{ animation: fabPulse .18s ease-out; }
@keyframes fabPulse{ 0%{ transform:scale(1)} 50%{ transform:scale(1.015)} 100%{ transform:scale(1)} } /* ослаблено */

.fab .fab-ico-wrap{ position:relative; width:22px; height:22px; display:inline-flex; align-items:center; justify-content:center; }
.fab .fab-ico-wrap .bi{ font-size:14px; }
.fab .fab-ring{ position:absolute; inset:-4px; pointer-events:none; }
.fab .fab-ring svg{ width:30px; height:30px; transform:rotate(-90deg); display:block; }
.fab .ring-bg{ stroke:rgba(255,255,255,.28); stroke-width:3.5; fill:none; }
.fab .ring{ stroke:rgba(255,255,255,.95); stroke-width:3.5; fill:none; stroke-linecap:round; transition:opacity .2s ease; }
.fab.disabled .ring{ opacity:.35; }

/* Анимация построения */
.animate-wipe { animation: wipeX .6s ease-out both; }
@keyframes wipeX { from { clip-path: inset(0 100% 0 0); opacity:.0; transform:translateX(-10px);} to { clip-path: inset(0 0 0 0); opacity:1;  transform:none;} }

/* Пустые состояния */
.empty{
  display:flex; flex-direction:column; align-items:center; justify-content:center; gap:10px;
  padding:28px; color:var(--on-surface-variant);
}
.empty svg{ width:128px; height:128px; }
.empty .title{ font-weight:700; color:var(--on-surface); }
.empty .sub{ opacity:.85; }

/* Пилюля статуса (с пульсом для online) */
.status-pill{
  display:inline-flex; align-items:center; gap:.5rem; padding:.28rem .6rem; border-radius:999px;
  background:rgba(255,255,255,.04); border:1px solid var(--border); font-weight:600;
}
.status-dot{ width:10px; height:10px; border-radius:50%; }
.status-ok{ background:#21d09c; box-shadow:0 0 10px rgba(33,208,156,.55); animation: okPulse 2.2s ease-in-out infinite; }
.status-warn{ background:#f4b942; box-shadow:0 0 10px rgba(244,185,66,.5); }
@keyframes okPulse{ 0%{ box-shadow:0 0 8px rgba(33,208,156,.4) } 50%{ box-shadow:0 0 14px rgba(33,208,156,.7) } 100%{ box-shadow:0 0 8px rgba(33,208,156,.4) } }

@media (max-width: 576px){
  #chart{ height:360px; }
  .kpi-value{ font-size:1.35rem; }
  .fab{ right:10px; bottom:10px; }
}
@media (max-width: 768px){
  #chart{ height:420px; }
  .toolbar{ gap:.6rem .8rem; }
  .nav-tabs .nav-link{ padding:.5rem .6rem; }
}
@media (max-width: 992px){ #chart{ height:480px; } .toolbar .group{ min-width: 46%; } .toolbar .group.narrow{ min-width: 30%; } }
@media (max-width: 1200px){ #chart{ height:520px; } }
