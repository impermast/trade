/* полный контент как в текущей версии пользователя — см. ниже */
:root{
  /* Палитра v2 */
  --primary:#6E46FF;
  --primary-variant:#5634CA;
  --secondary:#20C9C3;
  --secondary-variant:#1AAFAA;

  --bg:#101115;
  --surface:#171A1F;
  --on-surface:rgba(255,255,255,0.92);
  --on-surface-variant:rgba(255,255,255,0.70);
  --muted:var(--on-surface-variant);
  --border:#242834;
  --error:#F0685F;
  --grid:rgba(255,255,255,.05);

  --field-bg:#14171d;
  --field-bg-focus:#1d2129;

  --elev-1:0 2px 6px rgba(0,0,0,.28);
  --elev-2:0 8px 18px rgba(0,0,0,.28);

  --radius:14px;
  --focus:0 0 0 .2rem rgba(110,70,255,.20);

  /* Общая высота мелких контролов */
  --ctl-h: 38px;

  /* Динамические градиенты */
  --grad-1: linear-gradient(90deg, var(--primary), var(--secondary));
  --grad-2: linear-gradient(135deg, var(--primary-variant), var(--secondary-variant));

  /* Тон подсветок */
  --ink-active-bg: linear-gradient(90deg, rgba(110,70,255,.10), rgba(32,201,195,.08));
  --kpi-hover-bg: linear-gradient(135deg, rgba(110,70,255,.10), rgba(32,201,195,.08));
}

@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50%{ background-position: 100% 50%; }
  100%{ background-position: 0% 50%; }
}

[data-theme="light"]{
  --primary:#5E58FF;
  --primary-variant:#4B43D1;
  --secondary:#1EC1BB;
  --secondary-variant:#16A6A1;

  --bg:#F6F7FB;
  --surface:#FFFFFF;
  --on-surface:rgba(0,0,0,0.90);
  --on-surface-variant:rgba(0,0,0,0.66);
  --muted:var(--on-surface-variant);
  --border:#E5E7EF;
  --error:#E65C53;
  --grid:rgba(0,0,0,.06);

  --field-bg:#ffffff;
  --field-bg-focus:#f3f4f8;

  --elev-1:0 1px 2px rgba(0,0,0,.08), 0 1px 3px rgba(0,0,0,.04);
  --elev-2:0 6px 16px rgba(0,0,0,.10), 0 2px 22px rgba(0,0,0,.06);

  --ink-active-bg: linear-gradient(90deg, rgba(94,88,255,.08), rgba(30,193,187,.06));
  --kpi-hover-bg: linear-gradient(135deg, rgba(94,88,255,.06), rgba(30,193,187,.05));
}
/* Light theme fixes for .navbar-dark */
[data-theme="light"] .navbar.navbar-dark .navbar-brand,
[data-theme="light"] .navbar.navbar-dark .nav-link,
[data-theme="light"] .navbar.navbar-dark .form-check-label,
[data-theme="light"] .navbar.navbar-dark .navbar-text { color: var(--on-surface) !important; }
[data-theme="light"] .navbar.navbar-dark .form-check-input { border-color: var(--border) !important; background-color: transparent !important; }
[data-theme="light"] .navbar.navbar-dark .btn.btn-outline-light { color: var(--on-surface) !important; border-color: var(--border) !important; background: transparent !important; }
[data-theme="light"] .navbar.navbar-dark .btn.btn-outline-light.active,
[data-theme="light"] .navbar.navbar-dark .btn.btn-outline-light.show { color: #fff !important; }
/* Light: outline-light readability */
[data-theme="light"] .btn-outline-light { color: var(--on-surface) !important; border-color: var(--border) !important; }
[data-theme="light"] .btn-outline-light:hover { background-color: rgba(0,0,0,0.04) !important; }
[data-theme="light"] .btn-outline-light.active,
[data-theme="light"] .btn-outline-light.show { color: #fff !important; border-color: transparent !important; }

html, body { height:100%; background:var(--bg); color:var(--on-surface); overflow-x:hidden; }
body { font-family:"Roboto Flex", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif; }

/* Navbar */
.navbar{ background:var(--surface)!important; border-bottom:0 !important; box-shadow:0 6px 16px rgba(0,0,0,.18), var(--elev-1); }
.content{ padding:18px; }

/* Карточки */
.card{
  background:var(--surface); border:1px solid var(--border); border-radius:var(--radius);
  box-shadow:var(--elev-1); color:var(--on-surface);
  transition:box-shadow .18s ease, background .18s ease; /* без сдвига */
}
.card.kpi{ box-shadow:var(--elev-2); transition:transform .18s ease, box-shadow .18s ease, background .18s ease; }
.card.kpi:hover{ background: var(--kpi-hover-bg); transform: translateY(-1px) scale(1.005); box-shadow: 0 10px 26px rgba(0,0,0,.28); }

/* Типографика */
.kpi-sub{ font:600 0.95rem/1.25 "Roboto Flex", sans-serif; letter-spacing:.015em; color:var(--on-surface-variant)!important; }
.kpi-value{ font:700 1.6rem/1.15 "Roboto Flex", sans-serif; color:var(--on-surface)!important; }
.form-label, .text-muted { color:var(--on-surface-variant)!important; }

/* === Унификация размеров контролов === */
.form-control.form-control-sm,
.form-select.form-select-sm,
.nselect-toggle,
.btn.btn-sm{
  height: var(--ctl-h);
  padding-top: 0.38rem !important;
  padding-bottom: 0.38rem !important;
  line-height: calc(var(--ctl-h) - 2px - 0.76rem); /* визуальное выравнивание текста */
  border-radius:10px;
}
.btn.btn-sm{ display:inline-flex; align-items:center; }

/* Базовые поля */
.form-control, .form-select {
  color:var(--on-surface)!important;
  background-color:var(--field-bg) !important;
  border-radius:10px; border:1px solid var(--border) !important;
  transition:background-color .15s ease, border-color .15s ease, box-shadow .15s ease;
  -webkit-appearance:none; -moz-appearance:none; appearance:none;
}
.form-control:focus, .form-select:focus, .form-control:active, .form-select:active{
  background-color:var(--field-bg-focus) !important;
  color:var(--on-surface)!important; border-color:var(--primary)!important; box-shadow:var(--focus)!important; outline:none;
}
.form-control::placeholder { color:var(--on-surface-variant); opacity:1; }
.form-select option { color:var(--on-surface); background:var(--surface); }
.field-outlined{ border:1px solid var(--border); }

/* Глобальный стиль скроллбаров */
*{ scrollbar-width: thin; scrollbar-color: rgba(255,255,255,.18) transparent; }
*::-webkit-scrollbar{ height:10px; width:10px; }
*::-webkit-scrollbar-track{ background: transparent; }
*::-webkit-scrollbar-thumb{ background: rgba(255,255,255,.18); border-radius: 10px; border: 2px solid transparent; background-clip: padding-box; }
[data-theme="light"] *{ scrollbar-color: rgba(0,0,0,.22) transparent; }
[data-theme="light"] *::-webkit-scrollbar-thumb{ background: rgba(0,0,0,.22); border: 2px solid transparent; }

/* ===== Кастомные SELECT (NiceSelect) ===== */
.nselect{ position:relative; display:block; }
.nselect.is-open .nselect-toggle{ border-color:var(--primary) !important; box-shadow:var(--focus)!important; }
.nselect select{ position:absolute; inset:0; width:100%; height:100%; opacity:0; pointer-events:none; }

.nselect-toggle{
  display:flex; align-items:center; justify-content:space-between; gap:.6rem;
  width:100%; padding:.38rem .9rem; border-radius:10px;
  background:var(--field-bg); border:1px solid var(--border);
  color:var(--on-surface); cursor:pointer; user-select:none;
  transition:background .15s ease, border-color .15s ease, box-shadow .15s ease;
}
.nselect-toggle:hover{ background:var(--field-bg-focus); }
.nselect-toggle:focus-visible{ outline:none; border-color:var(--primary); box-shadow:var(--focus); }

.nselect-label{ overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.nselect-caret{
  width:18px; height:18px; flex:0 0 18px;
  background: center/contain no-repeat url("data:image/svg+xml,%3Csvg width='18' height='18' viewBox='0 0 16 16' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23BBBBBB' d='M4.47 6.97a.75.75 0 011.06 0L8 9.44l2.47-2.47a.75.75 0 111.06 1.06L8.53 11.06a.75.75 0 01-1.06 0L4.47 8.03a.75.75 0 010-1.06z'/%3E%3C/svg%3E");
  opacity:.9; transition: transform .15s ease, opacity .15s ease;
}
.nselect.is-open .nselect-caret{ transform:rotate(180deg); opacity:1; }

.nselect-menu{
  position:absolute; left:0; right:0; top:calc(100% + 6px);
  background:var(--surface); color:var(--on-surface);
  border:1px solid var(--border); border-radius:12px;
  box-shadow: var(--elev-2);
  padding:6px; z-index:1000; max-height:320px; overflow:auto;
  transform-origin: top; transform: scale(.98); opacity:0; pointer-events:none;
  transition: transform .12s ease, opacity .12s ease;
}
.nselect.is-open .nselect-menu{ transform: scale(1); opacity:1; pointer-events:auto; }

.nselect-option{
  padding:.45rem .6rem; border-radius:8px; cursor:pointer; user-select:none;
  display:flex; align-items:center; justify-content:space-between; gap:.6rem;
}
.nselect-option:hover{ background:rgba(255,255,255,.06); }
.nselect-option.is-selected{ background:var(--ink-active-bg); color:var(--on-surface); }
[data-theme="light"] .nselect-option:hover{ background:rgba(0,0,0,.06); }

/* ===== Числовые поля: свои степперы ===== */
input[type=number]::-webkit-outer-spin-button,
input[type=number]::-webkit-inner-spin-button{ -webkit-appearance: none; margin: 0; }
input[type=number]{ -moz-appearance:textfield; }

.num-input{ position:relative; display:block; }
.num-input .form-control{ padding-right:2.2rem !important; height: var(--ctl-h); }
.num-step{
  position:absolute; top:2px; bottom:2px; right:2px; width:26px;
  display:flex; flex-direction:column; gap:2px;
}
.num-step button{
  flex:1; border:1px solid var(--border); background:var(--field-bg);
  color:var(--on-surface-variant); border-radius:8px; font-size:12px; line-height:1;
  display:flex; align-items:center; justify-content:center; cursor:pointer;
  transition: background .15s ease, border-color .15s ease, color .15s ease, transform .05s ease;
}
.num-step button:hover{ background:var(--field-bg-focus); color:var(--on-surface); }
.num-step button:active{ transform: translateY(1px); }
.num-step .up::before,
.num-step .down::before{ content:""; width:12px; height:12px; background:center/contain no-repeat; display:block; opacity:.9; }
.num-step .up::before{ background-image:url("data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 16 16' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23BBBBBB' d='M8 4l4 5H4l4-5z'/%3E%3C/svg%3E"); }
.num-step .down::before{ background-image:url("data:image/svg+xml,%3Csvg width='12' height='12' viewBox='0 0 16 16' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23BBBBBB' d='M8 12l-4-5h8l-4 5z'/%3E%3C/svg%3E"); }

/* === Tabs + ink === */
.nav-tabs{ border-color:transparent; position:relative; }
[data-theme="dark"] .nav-tabs .nav-link{
  border:none; display:flex; align-items:center; gap:.5rem; color:var(--on-surface-variant)!important; background:transparent;
}
[data-theme="dark"] .nav-tabs .nav-link.active{
  background: #0f1217 !important; color: var(--on-surface) !important; font-weight: 600;
  border:1px solid var(--border) !important; border-bottom-color: transparent !important;
  border-top-left-radius: 12px; border-top-right-radius: 12px;
}
[data-theme="light"] .nav-tabs .nav-link{
  border:none; display:flex; align-items:center; gap:.5rem; color:var(--on-surface-variant)!important; background:transparent;
}
[data-theme="light"] .nav-tabs .nav-link.active{
  background-image: var(--ink-active-bg) !important; background-size: 200% 200%; animation: gradientShift 10s ease infinite;
  color: var(--on-surface) !important; font-weight: 600;
  border:1px solid var(--border) !important; border-bottom-color: transparent !important;
  border-top-left-radius: 12px; border-top-right-radius: 12px;
}
.tabs-ink{
  position:absolute; height:2px; bottom:-2px; background:var(--grad-1);
  border-radius:2px; pointer-events:none; width:0; transform:translateX(0);
  transition: width .28s cubic-bezier(.2,.8,.2,1.6), transform .28s cubic-bezier(.2,.8,.2,1.6);
  background-size: 200% 200%; animation: gradientShift 7s ease infinite;
}

/* === Сегментированные группы «как поле» (быстрый хвост, уровни логов) === */
.segmented-wrap{
  display:inline-flex; align-items:center; height: var(--ctl-h);
  background: var(--field-bg); border:1px solid var(--border);
  border-radius: 10px; padding: 2px; gap:0;
}
.segmented-wrap .btn{
  height: calc(var(--ctl-h) - 6px);
  border: none !important;
  border-radius: 8px !important;
  padding: .35rem .9rem;
  line-height: 1;
  color: var(--on-surface-variant);
  background: transparent;
}
.segmented-wrap .btn + .btn{ margin-left: 2px; }
.segmented-wrap .btn:hover{ background: var(--field-bg-focus) !important; color: var(--on-surface) !important; }
.segmented-wrap .btn.active{
  color:#fff!important; background: var(--grad-2) !important; background-size:200% 200%;
  animation: gradientShift 8s ease infinite;
  box-shadow:0 4px 12px rgba(0,0,0,.22);
}

/* Применение к конкретным блокам */
#tailSegments { /* сам .btn-group, оборачиваем как поле */
  display:inline-flex; align-items:center; height: var(--ctl-h);
  background: var(--field-bg); border:1px solid var(--border);
  border-radius: 10px; padding: 2px;
}
#tailSegments .btn{
  height: calc(var(--ctl-h) - 6px);
  border: none !important;
  border-radius: 8px !important;
  padding: .35rem .9rem;
  line-height: 1;
  color: var(--on-surface-variant);
  background: transparent;
}
#tailSegments .btn + .btn{ margin-left: 2px; }
[data-theme="dark"] #tailSegments .btn:hover,
[data-theme="dark"] #tailSegments .btn:focus{ color:#fff !important; background-color: var(--field-bg-focus) !important; }
#tailSegments .btn-outline-light.active{
  color:#fff!important; border-color:transparent!important;
  background:var(--grad-2)!important; background-size:200% 200%; animation:gradientShift 8s ease infinite;
  box-shadow:0 4px 12px rgba(0,0,0,.22);
}

/* Кнопки уровней логов как поле */
#logLevelButtons{
  display:inline-flex; align-items:center; height: var(--ctl-h);
  background: var(--field-bg); border:1px solid var(--border);
  border-radius: 10px; padding: 2px;
}
#logLevelButtons .btn{
  height: calc(var(--ctl-h) - 6px);
  border: none !important;
  border-radius: 8px !important;
  padding: .35rem .75rem;
  line-height: 1;
  color: var(--on-surface-variant);
  background: transparent;
}
#logLevelButtons .btn + .btn{ margin-left: 2px; }
#logLevelButtons .btn:hover{ background: var(--field-bg-focus) !important; color: var(--on-surface) !important; }
#logLevelButtons .btn.active{
  color:#fff!important; background: var(--grad-2) !important; background-size:200% 200%; animation: gradientShift 8s ease infinite;
  box-shadow:0 4px 12px rgba(0,0,0,.22);
}

/* Общий стиль для активных outline-кнопок вне групп */
.btn-outline-light.active,
.btn-outline-light.show{ background:var(--grad-2)!important; color:#fff!important; border-color:transparent!important; background-size:200% 200%; animation:gradientShift 8s ease infinite; }
[data-theme="dark"] .btn-outline-light:hover,
[data-theme="dark"] .btn-outline-light:focus{ color:#fff !important; background:rgba(255,255,255,.06) !important; }

/* Чипы */
.chips{ display:flex; gap:.5rem; overflow-x:auto; overflow-y:hidden; white-space:nowrap; scrollbar-width:none; }
.chips::-webkit-scrollbar{ display:none; }
.chip{
  flex:0 0 auto; display:inline-flex; align-items:center; gap:.35rem; padding:.42rem .8rem;
  border:1px solid var(--border); border-radius:999px; background:rgba(255,255,255,0.02); color:var(--on-surface);
  cursor:pointer; user-select:none; position:relative; overflow:hidden; line-height:1.05;
  transition:background .15s ease, border-color .15s ease, transform .12s ease, box-shadow .18s ease;
}
.chip .bi{ font-size:1rem; }
.chip:hover{ transform: translateY(-1px); }
.chip.selected{
  background:var(--grad-2); border-color:transparent; color:#fff;
  box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset, 0 6px 14px rgba(0,0,0,.22);
  background-size:200% 200%; animation:gradientShift 10s ease infinite;
}
.chip.selected::before{
  content:""; position:absolute; inset:-20% -30%;
  background: radial-gradient(60% 60% at 30% 30%, rgba(255,255,255,.20), rgba(255,255,255,0));
  filter: blur(6px); pointer-events:none;
}
.chip::after{ content:""; position:absolute; inset:auto; width:0; height:0; border-radius:50%; background:rgba(255,255,255,.18); transform:translate(-50%,-50%); transition:width .35s,height .35s; }
.chip:active::after{ left:var(--x); top:var(--y); width:220%; height:220%; }

.toolbar{ display:flex; flex-wrap:wrap; gap:.75rem 1rem; align-items:end; }
.toolbar .group{ display:flex; flex-direction:column; gap:.25rem; min-width:140px; }
.toolbar .group.narrow{ min-width:110px; }

/* Таблица */
.table-md3{ width:100%; border-collapse:separate; border-spacing:0; }
.table-md3 thead th{ position:sticky; top:0; background:var(--surface); z-index:1; border-bottom:1px solid var(--border); padding:.5rem .6rem; font-weight:700; }
.table-md3 tbody td{ border-bottom:1px solid var(--border); padding:.48rem .6rem; }
.table-md3 tbody tr:nth-child(even){ background:rgba(255,255,255,.02); }
.table-md3 .num{ text-align:right; font-variant-numeric: tabular-nums; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
.table-md3 thead th + th, .table-md3 tbody td + td{ box-shadow: inset 1px 0 0 rgba(255,255,255,.04); }

#chart{ height:560px; position:relative; }
.loading-overlay{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,.14); border-radius:10px; z-index:5; }
.log-box{ height:420px; overflow-y:auto; white-space:pre-wrap; background:#0b0e14; color:#e0e0e0; padding:10px; border:1px solid var(--border); border-radius:10px; line-height:1.35; }

/* Скелетоны */
.skeleton{
  display:inline-block;width:100%;height:1.2rem;border-radius:8px; position:relative; overflow:hidden;
  background: linear-gradient(90deg, rgba(255,255,255,.06), rgba(255,255,255,.12), rgba(255,255,255,.06));
  background-size:200% 100%; animation:shimmer 1.1s infinite;
}
.skeleton::after{
  content:""; position:absolute; inset:-30% -40%;
  background: radial-gradient(60% 60% at 20% 30%, rgba(255,255,255,.10), rgba(255,255,255,0) 70%);
  animation: shimmerMove 2.4s ease-in-out infinite; filter: blur(3px);
}
.skeleton.sm{height:.9rem} .skeleton.lg{height:1.8rem}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
@keyframes shimmerMove{0%{transform:translateX(-10%)}50%{transform:translateX(8%)}100%{transform:translateX(-10%)}}

/* Прогресс-лайн */
#topProgress{ position:fixed; left:0; right:0; top:0; height:3px; background:var(--grad-1);
  width:0; transition:width .25s; display:none; z-index:1200; pointer-events:none;
  background-size:200% 200%; animation:gradientShift 10s ease infinite; }

.chart-actions{ position:relative; }

/* FAB */
.fab{
  position:absolute; right:14px; bottom:14px; display:inline-flex; align-items:center; gap:.55rem;
  padding:.6rem 1rem .6rem .85rem; background:var(--grad-1); color:#fff; border:none;
  border-radius:999px; box-shadow:var(--elev-2); z-index:6; line-height:1; font-weight:700;
  background-size:200% 200%; animation:gradientShift 9s ease infinite;
  transition: filter .15s ease, box-shadow .2s ease, transform .15s ease;
}
.fab:hover{ filter:brightness(.98); box-shadow:0 14px 28px rgba(0,0,0,.28), 0 0 0 2px rgba(255,255,255,.06) inset; }
.fab:active{ transform: translateY(1px) scale(.997); }
.fab::after{ content:""; position:absolute; inset:-3px; border-radius:999px; border:2px solid rgba(255,255,255,.14); pointer-events:none; }
.fab.pulse{ animation: fabPulse .16s ease-out; }
@keyframes fabPulse{ 0%{ transform:scale(1)} 50%{ transform:scale(1.008)} 100%{ transform:scale(1)} }

.fab .fab-ico-wrap{ position:relative; width:22px; height:22px; display:inline-flex; align-items:center; justify-content:center; }
.fab .fab-ico-wrap::after{ content:""; position:absolute; inset:-3px; border-radius:50%; box-shadow: inset 0 0 0 1.5px rgba(255,255,255,.28); }
.fab .fab-ico-wrap .bi{ font-size:14px; }
.fab .fab-ring{ position:absolute; inset:-4px; pointer-events:none; }
.fab .fab-ring svg{ width:30px; height:30px; transform:rotate(-90deg); display:block; }
.fab .ring-bg{ stroke:rgba(255,255,255,.28); stroke-width:3.5; fill:none; }
.fab .ring{ stroke:rgba(255,255,255,.95); stroke-width:3.5; fill:none; stroke-linecap:round; transition:opacity .2s ease; }
.fab.disabled .ring{ opacity:.35; }

/* Пустые состояния */
.empty{ display:flex; flex-direction:column; align-items:center; justify-content:center; gap:10px; padding:28px; color:var(--on-surface-variant); }
.empty svg{ width:128px; height:128px; opacity:.9; filter:saturate(.94); }
.empty .title{ font-weight:700; color:var(--on-surface); font-size:1.05rem; }
.empty .sub{ opacity:.85; }

/* Пилюля статуса */
.status-pill{ display:inline-flex; align-items:center; gap:.5rem; padding:.28rem .6rem; border-radius:999px; background:rgba(255,255,255,.04); border:1px solid var(--border); font-weight:600; }
.status-dot{ width:10px; height:10px; border-radius:50%; }
.status-ok{ background:#21d09c; box-shadow:0 0 10px rgba(33,208,156,.55); animation: okPulse 2.2s ease-in-out infinite; }
.status-warn{ background:#f4b942; box-shadow:0 0 10px rgba(244,185,66,.5); }
@keyframes okPulse{ 0%{ box-shadow:0 0 8px rgba(33,208,156,.4) } 50%{ box-shadow:0 0 14px rgba(33,208,156,.7) } 100%{ box-shadow:0 0 8px rgba(33,208,156,.4) } }

@media (max-width: 576px){
  --ctl-h: 36px;
  #chart{ height:360px; } .kpi-value{ font-size:1.35rem; } .fab{ right:10px; bottom:10px; }
}
@media (max-width: 768px){
  #chart{ height:420px; } .toolbar{ gap:.6rem .8rem; } .nav-tabs .nav-link{ padding:.5rem .6rem; }
}
@media (max-width: 992px){ #chart{ height:480px; } .toolbar .group{ min-width: 46%; } .toolbar .group.narrow{ min-width: 30%; } }
@media (max-width: 1200px){ #chart{ height:520px; } }
